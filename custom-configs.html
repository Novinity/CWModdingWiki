<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#EB6237"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2024-10-14T12:50:51.9331948"><title>Custom Configs | Content Warning Modding Wiki</title><script type="application/json" id="virtual-toc-data">[{"id":"introduction","level":0,"title":"Introduction","anchor":"#introduction"},{"id":"using-configs","level":0,"title":"Using Configs","anchor":"#using-configs"},{"id":"conclusion","level":0,"title":"Conclusion","anchor":"#conclusion"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.css" rel="stylesheet"><link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Custom Configs | Content Warning Modding Wiki"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Content Warning Modding Wiki Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/cwmodding.wiki/1.0/custom-configs.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Custom Configs | Content Warning Modding Wiki"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/cwmodding.wiki/1.0/custom-configs.html#webpage",
    "url": "writerside-documentation/cwmodding.wiki/1.0/custom-configs.html",
    "name": "Custom Configs | Content Warning Modding Wiki",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentationcwmodding.wiki/#website",
    "url": "writerside-documentationcwmodding.wiki/",
    "name": "Content Warning Modding Wiki Help"
}</script><!-- End Schema.org --></head><body data-id="Custom-Configs" data-main-title="Custom Configs" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Modding-Topics.md|Modding Topics///Intermediate.md|Intermediate"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Content Warning Modding Wiki 1.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Custom-Configs" id="Custom-Configs.md">Custom Configs</h1><aside class="prompt" data-type="warning" data-title="" id="z4n92sw_3"><p id="z4n92sw_8"><span class="control" id="z4n92sw_10">WARNING</span></p><p id="z4n92sw_9"><span class="control" id="z4n92sw_11">This is an advanced article. While this introduces some C# concepts, it is highly recommended to understand C# and the basics of modding this game before reading this article.</span></p></aside><aside class="prompt" data-type="tip" data-title="" id="z4n92sw_4"><p id="z4n92sw_12"><span class="control" id="z4n92sw_14">INFO</span></p><p id="z4n92sw_13">This tutorial is taken and adapted from the <a href="https://lethal.wiki" id="z4n92sw_15" data-external="true" rel="noopener noreferrer">Lethal Company Modding Wiki</a>. For more resources refer to that.</p></aside><section class="chapter"><h2 id="introduction" data-toc="introduction">Introduction</h2><p id="z4n92sw_16">To make config files easy, BepInEx provides a built-in <a href="https://docs.bepinex.dev/api/BepInEx.Configuration.ConfigFile.html" id="z4n92sw_19" data-external="true" rel="noopener noreferrer">ConfigFile</a> class. With it, we don't have to worry about reading or writing to files ourselves, and we can easily bind our settings to the configuration file.</p><p id="z4n92sw_17">We are provided with a <code class="code" id="z4n92sw_20">base.Config</code> variable of type <code class="code" id="z4n92sw_21">ConfigFile</code> in our main plugin class. We can bind our settings to the <code class="code" id="z4n92sw_22">base.Config</code> config file with the <code class="code" id="z4n92sw_23">Bind</code> method.</p><aside class="prompt" data-type="note" data-title="" id="z4n92sw_18"><p id="z4n92sw_24"><span class="control" id="z4n92sw_28">INFO</span></p><p id="z4n92sw_25"><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/base" id="z4n92sw_29" data-external="true" rel="noopener noreferrer">base (C# Reference)</a></p><p id="z4n92sw_26"><span class="emphasis" id="z4n92sw_30">The <code class="code" id="z4n92sw_31">base</code> keyword is used to access members of the base class from within a derived class.</span></p><p id="z4n92sw_27">We don't actually need to specify the <code class="code" id="z4n92sw_32">base</code> anywhere in these examples, it is merely used to make it clear where the <code class="code" id="z4n92sw_33">Config</code> variable comes from.</p></aside></section><section class="chapter"><h2 id="using-configs" data-toc="using-configs">Using Configs</h2><p id="z4n92sw_34">In this example, we have the following settings in our config file:</p><ul class="list _bullet" id="z4n92sw_35"><li class="list__item" id="z4n92sw_39"><p id="z4n92sw_41"><span class="control" id="z4n92sw_43">GreetingText</span></p><ul class="list _bullet" id="z4n92sw_42"><li class="list__item" id="z4n92sw_44"><p id="z4n92sw_46">Is listed under the <span class="control" id="z4n92sw_47">[General]</span> section</p></li><li class="list__item" id="z4n92sw_45"><p id="z4n92sw_48">Is a <code class="code" id="z4n92sw_50">string</code> value</p><ul class="list _bullet" id="z4n92sw_49"><li class="list__item" id="z4n92sw_51"><p>Is <code class="code" id="z4n92sw_52">&quot;Hello, world!&quot;</code> by default</p></li></ul></li></ul></li><li class="list__item" id="z4n92sw_40"><p id="z4n92sw_53"><span class="control" id="z4n92sw_55">DisplayGreeting</span></p><ul class="list _bullet" id="z4n92sw_54"><li class="list__item" id="z4n92sw_56"><p id="z4n92sw_58">Is listed under the <span class="control" id="z4n92sw_59">[General.Toggles]</span> section</p></li><li class="list__item" id="z4n92sw_57"><p id="z4n92sw_60">Is a <code class="code" id="z4n92sw_62">boolean</code> value</p><ul class="list _bullet" id="z4n92sw_61"><li class="list__item" id="z4n92sw_63"><p>Is <code class="code" id="z4n92sw_64">true</code> by default</p></li></ul></li></ul></li></ul><section class="chapter"><h3 id="basic-example" data-toc="basic-example">Basic Example</h3><p id="z4n92sw_65">The most basic implementation could look something like this:</p><div class="code-block" data-lang="csharp">
using BepInEx;
using BepInEx.Configuration;

namespace MyMod;

[ContentWarningPlugin(MyPluginInfo.PLUGIN_GUID, MyPluginInfo.PLUGIN_VERSION, false)]
[BepInPlugin(&quot;Author.MyMod&quot;, &quot;MyMod&quot;, &quot;1.0.0&quot;)]
public class Plugin : BaseUnityPlugin
{
    private void Awake()
    {
        // We bind our settings to the config file provided by our plugin instance,
        // and we store the bound config entries in our variables
        var configGreeting = base.Config.Bind(
            &quot;General&quot;,                          // Config section
            &quot;GreetingText&quot;,                     // Key of this config
            &quot;Hello, world!&quot;,                    // Default value
            &quot;Greeting text upon game launch&quot;    // Description
        );

        var configDisplayGreeting = base.Config.Bind(
            &quot;General.Toggles&quot;,                  // Config subsection
            &quot;DisplayGreeting&quot;,                  // Key of this config
            true,                               // Default value
            &quot;To show the greeting text&quot;         // Description
        );
        
        // We can then access the values of the config entries with `.Value`
        if(configDisplayGreeting.Value)
            Logger.LogInfo(configGreeting.Value);
    }
}
</div><aside class="prompt" data-type="warning" data-title="" id="z4n92sw_67"><p id="z4n92sw_69"><span class="control" id="z4n92sw_71">NOTICE</span></p><p id="z4n92sw_70">Your config file <span class="control" id="z4n92sw_72">Will Not Be Created</span> until your mod is loaded in-game <span class="control" id="z4n92sw_73">at least once</span>. See the <a href="https://lethal.wiki/installation/configuration" id="z4n92sw_74" data-external="true" rel="noopener noreferrer">r2modman Configs Page</a> for using your configs.</p></aside><p id="z4n92sw_68">However, doing our configuration options like this in the <code class="code" id="z4n92sw_75">Awake</code> method can get messy very quickly, so we should probably separate them into their own class. Thankfully, this is simple.</p></section><section class="chapter"><h3 id="custom-configuration-class" data-toc="custom-configuration-class">Custom Configuration Class</h3><p id="z4n92sw_76">Here we have separated our configuration settings into their own class <code class="code" id="z4n92sw_82">MyModConfig</code>.</p><aside class="prompt" data-type="tip" data-title="" id="z4n92sw_77"><p id="z4n92sw_83"><span class="control" id="z4n92sw_85">INFO</span></p><p id="z4n92sw_84">We have made <code class="code" id="z4n92sw_86">MyModConfig BoundConfig</code> a property. To learn about properties, see <a href="https://learn.microsoft.com/en-us/dotnet/csharp/properties" id="z4n92sw_87" data-external="true" rel="noopener noreferrer">Properties</a></p></aside><div class="code-block" data-lang="csharp">
// ... in our plugin class
internal static MyModConfig BoundConfig { get; private set; } = null!; 
private void Awake()
{
    // Create a new instance of our config class which has our setting entries
    BoundConfig = new MyModConfig(base.Config); 
    
    // We access our config variables through the instance
    if(BoundConfig.displayGreeting.Value)
        Logger.LogInfo(BoundConfig.greeting.Value);
}
</div><aside class="prompt" data-type="tip" data-title="" id="z4n92sw_79"><p id="z4n92sw_88"><span class="control" id="z4n92sw_90">INFO</span></p><p id="z4n92sw_89">We have marked our public variables as <code class="code" id="z4n92sw_91">readonly</code>. This prevents assigning to these variables after the constructor exits. See <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/readonly" id="z4n92sw_92" data-external="true" rel="noopener noreferrer">readonly (C# Reference)</a>.</p></aside><div class="code-block" data-lang="csharp">
// We have made a new file for this configuration class
using BepInEx.Configuration;

namespace MyMod;

class MyModConfig
{
    // We define our config variables in a public scope
    public readonly ConfigEntry&lt;string&gt; greeting;
    public readonly ConfigEntry&lt;bool&gt; displayGreeting;

    public MyModConfig(ConfigFile cfg)
    {
        greeting = cfg.Bind(
            &quot;General&quot;,                          // Config section
            &quot;GreetingText&quot;,                     // Key of this config
            &quot;Hello, world!&quot;,                    // Default value
            &quot;Greeting text upon game launch&quot;    // Description
        );

        displayGreeting = cfg.Bind(
            &quot;General.Toggles&quot;,                  // Config subsection
            &quot;DisplayGreeting&quot;,                  // Key of this config
            true,                               // Default value
            &quot;To show the greeting text&quot;         // Description
        );
    }
}
</div><p id="z4n92sw_81">However, we still have an issue: if we change what config entries our config file has, the old config entries will stay. BepInEx also writes to the config file every time to when we bind a setting by default, which is inefficient and slow. So, let's solve these issues.</p></section><section class="chapter"><h3 id="better-configuration" data-toc="better-configuration">Better Configuration</h3><p id="z4n92sw_93">Here we disable the <code class="code" id="z4n92sw_96">SaveOnConfigSet</code> property which is enabled by default in the ConfigFile BepInEx provides us with, and then re-enable it after we have bound all our settings.</p><p id="z4n92sw_94">We also clear the private <code class="code" id="z4n92sw_97">OrphanedEntries</code> dictionary, which will get rid of all the orphaned settings when the config file is saved.</p><div class="code-block" data-lang="csharp">
using System.Reflection;
using System.Collections.Generic;
using HarmonyLib;
using BepInEx.Configuration;
// ...
class MyModConfig
{
    // ...
    public MyModConfig(ConfigFile cfg)
    {
        // We want to disable saving our config file every time we bind a
        // setting as it's inefficient and slow
        cfg.SaveOnConfigSet = false; 

        greeting = cfg.Bind(
            // ...
        );

        displayGreeting = cfg.Bind(
            // ...
        );
        
        // Get rid of old settings from the config file that are not used anymore
        ClearOrphanedEntries(cfg); 
        // We need to manually save since we disabled `SaveOnConfigSet` earlier
        cfg.Save(); 
        // And finally, we re-enable `SaveOnConfigSet` so changes to our config
        // entries are written to the config file automatically from now on
        cfg.SaveOnConfigSet = true; 
    }

    static void ClearOrphanedEntries(ConfigFile cfg) 
    { 
        // Find the private property `OrphanedEntries` from the type `ConfigFile`
        PropertyInfo orphanedEntriesProp = AccessTools.Property(typeof(ConfigFile), &quot;OrphanedEntries&quot;); 
        // And get the value of that property from our ConfigFile instance
        var orphanedEntries = (Dictionary&lt;ConfigDefinition, string&gt;)orphanedEntriesProp.GetValue(cfg); 
        // And finally, clear the `OrphanedEntries` dictionary
        orphanedEntries.Clear(); 
    } 
}
</div></section></section><section class="chapter"><h2 id="conclusion" data-toc="conclusion">Conclusion</h2><p id="z4n92sw_98">Now you have config files for your mods!</p></section><div class="last-modified">Last modified: 14 October 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="intermediate.html" class="navigation-links__prev">Intermediate</a><a href="asset-bundling.html" class="navigation-links__next">Asset Bundling</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b419/app.js"></script></body></html>